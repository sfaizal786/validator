<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Email Validator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .container { margin-top: 50px; max-width: 700px; }
        .card { margin-bottom: 30px; }
        #statusTable { margin-top: 20px; }
        .status-valid { color: green; font-weight: bold; }
        .status-invalid { color: red; font-weight: bold; }
        #downloadLink { margin-top: 15px; }
    </style>
</head>
<body>
<div class="container">
    <h1 class="mb-4 text-center">ðŸ“§ Email Validator</h1>

    <!-- Single Email -->
    <div class="card shadow-sm">
        <div class="card-body">
            <h5 class="card-title">Single Email</h5>
            <div class="input-group mb-3">
                <input type="email" id="singleEmail" class="form-control" placeholder="Enter email" required>
                <button class="btn btn-primary" id="validateSingleBtn">Validate</button>
            </div>
        </div>
    </div>

    <!-- Bulk Email -->
    <div class="card shadow-sm">
        <div class="card-body">
            <h5 class="card-title">Bulk Email (CSV or Excel)</h5>
            <div class="input-group mb-3">
                <input type="file" id="bulkFile" class="form-control">
                <button class="btn btn-success" id="validateBulkBtn">Upload & Validate</button>
            </div>
        </div>
    </div>

    <!-- Status Table -->
    <div class="card shadow-sm">
        <div class="card-body">
            <h5 class="card-title">Validation Status</h5>
            <table class="table table-bordered table-striped" id="statusTable">
                <thead>
                <tr>
                    <th>Email</th>
                    <th>Status</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>
            <div id="downloadLink"></div>
        </div>
    </div>
</div>

<script>
const statusTableBody = document.querySelector("#statusTable tbody");
const downloadLinkDiv = document.getElementById("downloadLink");

function addStatus(email, status) {
    let row = Array.from(statusTableBody.rows).find(r => r.cells[0].textContent === email);
    const statusClass = status === "Valid" ? "status-valid" : "status-invalid";
    if (!row) {
        row = document.createElement("tr");
        row.innerHTML = `<td>${email}</td><td class="${statusClass}">${status}</td>`;
        statusTableBody.appendChild(row);
    } else {
        row.cells[1].textContent = status;
        row.cells[1].className = statusClass;
    }
}

// Single Email
document.getElementById("validateSingleBtn").addEventListener("click", async () => {
    const email = document.getElementById("singleEmail").value.trim();
    if (!email) return;

    const res = await fetch("/validate-single", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({email})
    });
    const data = await res.json();
    addStatus(data.email, data.status);
});

// Bulk Email
document.getElementById("validateBulkBtn").addEventListener("click", async () => {
    const fileInput = document.getElementById("bulkFile");
    if (!fileInput.files.length) return;

    statusTableBody.innerHTML = "";
    downloadLinkDiv.innerHTML = "";

    const formData = new FormData();
    formData.append("file", fileInput.files[0]);

    const res = await fetch("/validate-bulk", {method: "POST", body: formData});
    const reader = res.body.getReader();
    const decoder = new TextDecoder();

    while (true) {
        const {done, value} = await reader.read();
        if (done) break;
        const lines = decoder.decode(value).split("\n").filter(Boolean);
        lines.forEach(line => {
            if (line.startsWith("Download CSV:")) {
                const url = line.replace("Download CSV:", "").trim();
                downloadLinkDiv.innerHTML = `<a href="${url}" class="btn btn-primary">ðŸ“¥ Download CSV</a>`;
            } else {
                const [email, status] = line.split(" - ");
                if (email && status) addStatus(email, status);
            }
        });
    }
});
</script>
</body>
</html>
